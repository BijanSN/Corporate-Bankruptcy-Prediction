{
    "collab_server" : "",
    "contents" : "library(RPostgres)\n#install.packages(\"dplyr\")\nlibrary(dplyr)\n\nwrds <- dbConnect(Postgres(),\n                  host='wrds-pgdata.wharton.upenn.edu',\n                  port=9737,\n                  dbname='wrds',\n                  sslmode='require',\n                  user='bijansn',\n                  password='PasswordForWRDS123')\n\n\n\n\n######## see all the available libraries : \n\nres <- dbSendQuery(wrds, \"select distinct table_schema\n                   from information_schema.tables\n                   where table_type ='VIEW'\n                   or table_type ='FOREIGN TABLE'\n                   order by table_schema\")\ndata <- dbFetch(res, n=-1)\ndbClearResult(res)\ndata\nView(data)\n\n\n### we want : crsp\n\n\n######### see the datasets :\n\nres <- dbSendQuery(wrds, \"select distinct table_name\n                   from information_schema.columns\n                   where table_schema='crsp'\n                   order by table_name\")\ndata <- dbFetch(res, n=-1)\ndbClearResult(res)\nView(data)\n\n######## we want : comphead  (link gvkey and name)\n\n\n\n\n\nres <- dbSendQuery(wrds, \"select column_name\n                   from information_schema.columns\n                   where table_schema='crsp'\n                   and table_name='comphead'\n                   order by column_name\")\ndata <- dbFetch(res, n=-1)\ndbClearResult(res)\ndata\nView(data)\n\n############  Query 2 :\n\n\n\nres <- dbSendQuery(wrds, \"SELECT * FROM comphead WHERE gvkey IN firmsID\")\ndata <- dbFetch(res, n=-1) # take all from selected\ndbClearResult(res)\ndata\n\nclean_data= na.omit(data)\n#View(clean_data)\n\n\n\nfirmsID=readLines(\"Compagny_gvkey.txt\")\nfirmsID= paste(firmsID,collapse=\"\\n\")\n\n\n\n\n\nres <- dbSendQuery(wrds, \"select column_name\n                   from information_schema.columns\n                   where table_schema='crsp'\n                   and table_name='ccmxpf_linktable'\n                   order by column_name\")\ndata <- dbFetch(res, n=-1)\ndbClearResult(res)\ndata\n\n\n\n\n\n\n\n\n\n############  Query 2 :\n\nres <- dbSendQuery(wrds, \"select * from ccmxpf_linktable\")\ndata <- dbFetch(res, n=-1) # take all from selected\ndbClearResult(res)\ndata\n\nclean_data= na.omit(data)\n#View(clean_data)\n\n\n\n\n\n\n\n\n\n\n\n\n\n# we want : conml (name of the compagny!),gvkey (the link) , gsector,sic \n\n\n############\nccmlinktable \n\n############  Query 1 :\n\n\nres <- dbSendQuery(wrds, \"select conml,gvkey,gsector,sic\n                   from comphead\")\ndata <- dbFetch(res, n=-1) # take all companies\ndbClearResult(res)\ndata\n\nclean_data= na.omit(data)\n#View(clean_data)\n\n\n#Query 2 : \n\n\nres <- dbSendQuery(wrds, \"select gvkey, splticrm, datadate from adsprate\")\ndata <- dbFetch(res, n=10000)\ndbClearResult(res)\ndata\n#View(data)\n\nclean_data=na.omit(data)\n\ndistinct(clean_data,gvkey)\n\n\n\n\n#Query 1 :\n\nres <- dbSendQuery(wrds, \"select * from crsp.dsf\")\ndata <- dbFetch(res, n=10)\ndbClearResult(res)\ndata\nView(data)\n\n\n\n\nres <- dbSendQuery(wrds, \"select * from adsprate\")\ndata <- dbFetch(res, n=-1)\ndbClearResult(res)\ndata\n\nView(data)\n\nsave(data, file = \"Compagny_Default.RData\")\n\n\n\n\nclean_data=na.omit(data)\n\nuniquekey=distinct(clean_data,gvkey)\nN=nrow(uniquekey) #351 firms\n\n\n\n\nID=which(clean_data$gvkey ==uniquekey[1,1])\n #last element of the firm\n\nclean_data[ID]\n\n\nclean_data$gvkey[1]\nView(uniquekey)\n\nfor(i in N){\n  ID=which(clean_data$gvkey ==uniquekey[i,1])\n  #ID[length(ID)]\n}\n\n  \n # if(clean_data$gvkey[i] == uniquekey)\n #   print(clean_data$splticrm)\n#}\n\n\n\n\n#if(dataNames$gvkey == data$\n\n#data[]\nView(data$splticrm)\n\nif(data$splticrm=='D'){\n  print(data$gvkey)\n}\n\n\nres2 <- dbSendQuery(wrds, \"select a.conm, a.gvkey, \n                   from COMPHEAD a join adsprate b\n                   on a.gvkey = b.gvkey\")\ndata <- dbFetch(res2, n = -1)\ndbClearResult(res)\ndata\nView(data)\n   \n   \n\n\n\n\n\n\n\n#-------------------------fundamentals : \n\n\n\n\n######## see all the available libraries : \n\nres <- dbSendQuery(wrds, \"select distinct table_schema\n                   from information_schema.tables\n                   where table_type ='VIEW'\n                   or table_type ='FOREIGN TABLE'\n                   order by table_schema\")\ndata <- dbFetch(res, n=-1)\ndbClearResult(res)\ndata\nView(data)\n\n\n### we want : wrdsapps\n\n\n######### see the datasets :\n\nres <- dbSendQuery(wrds, \"select distinct table_name\n                   from information_schema.columns\n                   where table_schema='wrdsapps'\n                   order by table_name\")\ndata <- dbFetch(res, n=-1)\ndbClearResult(res)\nView(data)\n\n######## we want : comphead  (link gvkey and name)\n\n\n\n\n\nres <- dbSendQuery(wrds, \"select column_name\n                   from information_schema.columns\n                   where table_schema='wrdsapps'\n                   and table_name='firm_ratio'\n                   order by column_name\")\ndata <- dbFetch(res, n=-1)\ndbClearResult(res)\ndata\nView(data)\n\n\n\n\n\n\n\n\n\n\n\nsave.image()\n",
    "created" : 1602539487136.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "836973900",
    "id" : "309895C7",
    "lastKnownWriteTime" : 1602539707,
    "last_content_update" : 1602539707201,
    "path" : "C:/Users/Vida/Desktop/ThÃ¨se/Corporate Default Prediciton/ARCHIVE/Query1testCOPY.R",
    "project_path" : "ARCHIVE/Query1testCOPY.R",
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}